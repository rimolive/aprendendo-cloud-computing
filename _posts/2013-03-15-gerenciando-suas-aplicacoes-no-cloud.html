---
layout: post
title: Gerenciando suas aplicações no cloud com as ferramentas de cliente
date: '2013-03-15T19:43:00.002-03:00'
author: Ricardo Martinelli Oliveira
tags:
- openshift
- rhc
modified_time: '2013-03-15T19:43:44.604-03:00'
blogger_id: tag:blogger.com,1999:blog-3438555562642680163.post-12565326714509955
blogger_orig_url: http://aprendendo-cloud-computing.blogspot.com/2013/03/gerenciando-suas-aplicacoes-no-cloud.html
comments: true
---

Neste post, irei mostrar a ferramenta <i>rhc</i>, que permite gerenciar em linha de comando todas as aplicações, seu domínio e outras informações referentes à sua conta OpenShift. No primeiro post, eu mostrei muito por cima como criar uma primeira aplicação usando a IDE Eclipse utilizando o Plugin <i>JBoss Tools. </i>Tentarei aqui ser o mais neutro possível a respeito de plataformas então eu vou explicar como instalar a ferramenta no Linux, Mac OS e Windows.<br /><br /><h3>Instalando a ferramenta no Linux</h3><div>Para poder utilizar a ferramenta no Linux, é preciso instalar os seguintes pacotes:</div><div><ul><li>rubygems</li><li>git</li></ul><div>Como podem ver, a ferramenta foi escrita em Ruby e por isso apesar de mencionar a instalação de apenas dois pacotes eles trarão dependências adicionais para poder fazer os pacotes principais funcionarem.</div></div><div>Após a instalação com sucesso dos pacotes, basta executar o seguinte comando para instalar o rhc:</div><div><blockquote class="tr_bq">$ sudo gem install rhc</blockquote></div><h3>Instalando a ferramenta no Mac</h3><div>Para instalar a ferramenta no Mac, é preciso ter os seguintes pré-requisitos:</div><div><ul><li>Acesso a root</li><li><a href="http://developer.apple.com/xcode">Suite XCode completa</a> ou <a href="http://code.google.com/p/git-osx-installer/">git for OS X</a></li></ul><div>Após a instalação, basta executar o comando:</div></div><div><blockquote class="tr_bq">$ sudo gem install rhc</blockquote></div><h3>Instalando a ferramenta no Windows</h3><div>Para instalar a ferramenta no Windows, é preciso ter os seguintes pré-requisitos:</div><div><ul><li>Instalar o <a href="http://rubyinstaller.org/">Ruby 1.9 for Windows</a>&nbsp;(Lembre-se de marca a opção "Add Ruby executables to your PATH")</li><li>Instalar o <a href="http://msysgit.github.com/">Git for Windows</a>&nbsp;(Marque a opção&nbsp;"Run Git from the Windows Command Prompt")</li></ul><div>Feito isso, basta executar o comando:</div></div><div><blockquote class="tr_bq">C:\&gt; gem install rhc</blockquote></div><h3>Configuração inicial da ferramenta</h3><div>O primeiro comando que iremos aprender é o comando:<br /><blockquote class="tr_bq">$ rhc&nbsp;setup</blockquote>Nele, você irá fazer as configurações iniciais da ferramenta, como gerar as chaves de segurança SSH para o login da ferramenta(muito importante para poder conectar ao repositório git das aplicações), a criação de um nome de domínio(com ele, todas as aplicações criadas pela sua conta levarão esse nome único para identificar aplicações criadas por você), e verificar alguma pendência de configuração exigida pelo OpenShift.<br />Após o procedimento de setup, ele irá gerar os seguintes arquivos:<br /><blockquote class="tr_bq">&lt;user_dir&gt;/.openshift/express.conf<br />&lt;user_dir&gt;/.ssh</blockquote>O primeiro é uma configuração bem básica do Openshift (inicialmente um usuário padrão ao usar o comando rhc, que pode usar outro usuário adicionando a opção -l no comando, e o endereço do servidor Openshift) e o outro é o repositório de chaves SSH para comunicação com os serviços Openshift. Sem isso, você não conseguirá fazer um git clone do repositório.<br /><h3>Criando a aplicação</h3><div>Depois de preparado o ambiente, estamos prontos para a criação da aplicação. O comando para criar é:</div><blockquote class="tr_bq">$ rhc app create -a &lt;nome_da_aplicacao&gt; -t &lt;tipo_aplicacao&gt;</blockquote>Onde o &lt;tipo_aplicacao&gt; pode ser:<br /><br /><ul><li>&nbsp;dyi-0.1</li><li>jbossas-7</li><li>jbosseap-6.0</li><li>jenkins-1.4</li><li>nodejs-0.6</li><li>perl-5.10</li><li>php-5.3</li><li>python-2.6</li><li>python-2.7</li><li>python-3.3</li><li>ruby-1.8</li><li>ruby-1.9</li><li>jbossews-1.0 (basicamente um Tomcat 6)</li><li>jbossews-2.0 (basicamente um Tomcat 7)</li><li>zend-5.6</li></ul><div>Como podem ver na lista, a variedade de linguagens/servidores para desenvolvimento no Openshift tem crescido cada vez mais. E ainda podemos criar nosso próprio com o Do-It-Yourself Cartridge (farei um post explicando sobre isso). Essa tarefa irá criar um processo automático que no final irá gerar um endereço do repositório git e também a URL da sua aplicação no formato http://&lt;nome_da_aplicacao&gt;-&lt;nome_do_dominio&gt;.rhcloud.com</div><br /><h3>Snapshots da aplicação</h3><div>Caso você queira criar backups de sua aplicação para posteriormente voltar às versões anteriores, o Openshift permite que você crie snapshots da sua aplicação e restaurá-los quando quiser. Em outras palavras, o snapshot é arquivo compactado que contém tudo que sua aplicação precisa para ser recuperada em uma outra gear do Openshift, tais como as variáveis de ambiente, o repositório git, os binários da aplicação, etc. Para criar um snapshot, basta executar o comando:</div><div><br /></div><div>$ rhc snapshot save -a &lt;nome_da_aplicacao&gt; -f &lt;nome_do_arquivo&gt;<br /><br />Assim, caso você queira restaurar a aplicação, execute o comando:<br /><br /></div>$ rhc snapshot restore&nbsp;-a &lt;nome_da_aplicacao&gt; -f &lt;nome_do_arquivo&gt;<br /><h3>Diagnóstico de problemas</h3></div><div>Sempre pode ocorrer problemas e que precisam de nossa intervenção para que nossa aplicação possa voltar ao ar ou até mesmo monitorar nossas aplicações para procurar eventuais problemas. Para isso, o rhc possui alguns comando que podem auxiliar o desenvolvedor a encontrar o problema.<br />O primeiro de todos os comandos irá verificar a saúde da infraestrutura do Openshift:<br /><br />$ rhc server<br /><br />Nele, é possível verificar se o problema não é generalizado e portanto se há alguma ação que pode ser realmente tomada por conta da sua aplicação. Caso apareça a mensagem "All systems running fine", então estamos à salvo... =D<br />O segundo comando inspecionará todos os logs da sua aplicação e irá imprimir (sob demanda) as mensagens deles. O comando é:<br /><br /></div><div>$ rhc tail -a &lt;nome_da_aplicacao&gt;<br /><br />Por fim, pode ser necessário inspecionar a performance em si da aplicação, assim verificando se a mesma está muito lenta, então pode ser necessário inspecionar as Threads do sistema. O comando para gerar o thread dump (um arquivo que descreve todas as Thread em execução do sistema) é:<br /><br /></div><div>$ rhc threaddump -a &lt;nome_da_aplicacao&gt;</div><div><br />Após a execução desse comando ele irá retornar uma mensagem dizendo onde o Thread Dump estará disponível, podendo inspecionar utilizando o comando descrito anteriormente. Para ser mais exato, o próprio rhc irá já enviar o comando completo que deve ser executado para inspecionar o Thread Dump.</div><h3>Conclusão</h3><div>Espero que esse post seja de muita utilidade a todos pois alguns usuários Openshift como eu adoram em algum momento utilizar a linha de comando para criar suas aplicações e até mesmo automatizar alguns processos. Fica aqui uma dica: todos esses comandos do rhc por trás há uma API REST que é consumida pelos comandos (que são nada mais nada menos que código Ruby). Em um post futuro explicarei sobre a API REST.</div>