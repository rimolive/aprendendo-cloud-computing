---
layout: post
title: 'Django nas nuvens: Python com OpenShift'
date: '2014-01-11T20:58:00.002-02:00'
author: Ricardo Martinelli Oliveira
tags:
- openshift
- django
- python
modified_time: '2014-02-02T17:10:37.810-02:00'
thumbnail: http://2.bp.blogspot.com/-2vRCMLI2inM/UtG7b0omRkI/AAAAAAAABuQ/hoHtRRELl_o/s72-c/Screenshot+from+2014-01-11+19:43:56.png
blogger_id: tag:blogger.com,1999:blog-3438555562642680163.post-8302265906617904378
blogger_orig_url: http://aprendendo-cloud-computing.blogspot.com/2014/01/django-nas-nuvens-python-com-openshift.html
---

Esse e alguns próximos posts serão a respeito de um projeto novo que pretendo finalmente botar em prática sobre um sistema que gostaria muito de desenvolver. Tenho algumas idéias com algumas features que virão no futuro no OpenShift e que virão também para complementar essa série. Iniciarei essa série falando sobre Python e de um framework muito utilizado pelos programadores Python: O Django.<br /><br /><h3>Introdução </h3>O Django é um framework MVC que auxilia na construção de aplicações Web com Python utilizando o bom e velho padrão MVC (Model-View-Controller). Nele, é possível criar aplicações de forma bem rápida e simples. Bastando criar algumas linhas de código e você já consegue ter CRUDs básicas funcionando.<br /><br /><h3>Primeiros passos</h3>Para iniciar o desenvolvimento, vamos criar uma aplicação utilizando a ferramenta RHC (em um post anterior eu expliquei como utilizar)<br /><blockquote class="tr_bq">$ rhc create-app djangoapp python-2.7 --from-code git://github.com/openshift/django-example.git</blockquote><div class="separator" style="clear: both; text-align: center;"></div>Após a criação da aplicação,você poderá acessar através da URL http://djangoapp-&lt;dominio&gt;.rhcloud.com. A página inicial será assim:<br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-2vRCMLI2inM/UtG7b0omRkI/AAAAAAAABuQ/hoHtRRELl_o/s1600/Screenshot+from+2014-01-11+19:43:56.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-2vRCMLI2inM/UtG7b0omRkI/AAAAAAAABuQ/hoHtRRELl_o/s1600/Screenshot+from+2014-01-11+19:43:56.png" height="250" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Página inicial da aplicação Django</td></tr></tbody></table>Falarei sobre esse link <i>admin</i>&nbsp;logo a seguir. A estrutura do projeto Django fica dessa forma:<br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-RYCqaQXmT4M/UtG6yQMVKNI/AAAAAAAABuI/5QNVYfFRYL8/s1600/Screenshot+from+2014-01-11+19:42:04.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://1.bp.blogspot.com/-RYCqaQXmT4M/UtG6yQMVKNI/AAAAAAAABuI/5QNVYfFRYL8/s1600/Screenshot+from+2014-01-11+19:42:04.png" height="400" width="307" /></a></div><br /><h3>CRUD sem esforço: A interface administrativa do Django</h3><div>Uma das coisas que gostei do Django é justamente porque ele facilita muito a geração de telas de cadastro, mais conhecidas como CRUD (Create-Retrieve-Update-Delete), tornando assim mais rápido o desenvolvimento de telas que realmente importam para o sistema. Sem contar que ele já fornece autenticação de usuários na criação da aplicação.</div><div>Para isso o Django possui o Django Admin Site, que é uma série de pacotes que permite criar essas telas sem muito esforço de código. Basta algumas linhas e logo é possível fazer o CRUD das suas entidades. Como o Django Admin Site já está acessível assim que você cria a aplicação no OpenShift, já é possível acessá-la.&nbsp;</div><div>Mas espera! Falta a senha do admin e sem ela não dá pra acessar. Para pegar a senha, é simples: basta acessar a aplicação via SSH e procurar pelo arquivo <i>app-root/runtime/data/CREDENTIALS</i>&nbsp;e lá estará os dados de usuário e senha para acessar o Django Admin Site:</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://2.bp.blogspot.com/-x89wffyhTzQ/UtG4xyqjfBI/AAAAAAAABt0/a8LlKSCfAxA/s1600/Screenshot+from+2014-01-11+15:57:17.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://2.bp.blogspot.com/-x89wffyhTzQ/UtG4xyqjfBI/AAAAAAAABt0/a8LlKSCfAxA/s1600/Screenshot+from+2014-01-11+15:57:17.png" height="250" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Capturando a senha gerada pelo OpenShift</td></tr></tbody></table>Para habilitar o Django Admin Site para procurar pela classe de modelo que iremos adicionar, abra o arqivo <i>wsgi/openshift/settings.py</i> e adicione na seção INSTALLED_APPS o conteúdo abaixo que está em negrito:<br /><blockquote class="tr_bq">INSTALLED_APPS = (<br />&nbsp; &nbsp; 'django.contrib.auth',<br />&nbsp; &nbsp; 'django.contrib.contenttypes',<br />&nbsp; &nbsp; 'django.contrib.sessions',<br />&nbsp; &nbsp; 'django.contrib.sites',<br />&nbsp; &nbsp; 'django.contrib.messages',<br />&nbsp; &nbsp; 'django.contrib.staticfiles',<br />&nbsp; &nbsp; # Uncomment the next line to enable the admin:<br />&nbsp; &nbsp; 'django.contrib.admin',<br />&nbsp; &nbsp; # Uncomment the next line to enable admin documentation:<br />&nbsp; &nbsp; # 'django.contrib.admindocs',<br /><b>&nbsp; &nbsp; 'openshift',</b>)</blockquote>Depois, abra (ou crie se não existir) o arquivo <i>wsgi/openshift/models.py</i> e adicione o seguinte conteúdo:<br /><blockquote class="tr_bq">from django.db import models<br />class Pessoa(models.Model):<br />&nbsp; &nbsp; nome = models.CharField(max_length=40)<br />&nbsp; &nbsp; idade = models.IntegerField()</blockquote>Por fim, abra (ou crie se não existir) o arquivo <i>wsgi/openshift/admin.py</i> e adicione o seguinte conteúdo:<br /><blockquote class="tr_bq">from django.contrib import admin<br />from openshift.models import *<br />admin.site.register(Pessoa)</blockquote><div>Depois disso, é só enviar o código para o OpenShift:</div><blockquote class="tr_bq">$ git add . --all<br />$ git commit -m "Adicionando o Django Admin Site"<br />$ git push</blockquote><div class="separator" style="clear: both; text-align: left;">Com isso, eu habilitei o Django Admin Site e criei um primeiro cadastro de Pessoas (conforme código em models.py). Após isso, acesse o Django Admin Site e você verá que apareceu uma seção openshift e um link para o cadastro de Pessoas:</div><div class="separator" style="clear: both; text-align: center;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="http://4.bp.blogspot.com/-qH5z2dh_pno/UtHFAdRZ_cI/AAAAAAAABug/Ly3vWl2n3Us/s1600/Screenshot+from+2014-01-11+20:24:51.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" src="http://4.bp.blogspot.com/-qH5z2dh_pno/UtHFAdRZ_cI/AAAAAAAABug/Ly3vWl2n3Us/s1600/Screenshot+from+2014-01-11+20:24:51.png" height="242" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Django Admin Site com o cadastro de Pessoas</td></tr></tbody></table><div>Agora é só fazer o cadastro de pessoas como preferir. =D</div><h3>E se eu quiser expor minha aplicação com REST?</h3><div>Como eu estou criando uma aplicação com diversas formas de acesso (Web, Mobile e Desktop), eu precisava expor meus modelos de forma que pudesse ser acessados para manipular meus cadastros. Procurei pela Internet (Google, pra ser mais específico) e encontrei um Framework muito bacana chamado <i>Django REST Framework</i>, que já faz o trabalho de capturar todos os modelos criados para o Django Admin Site e expor operações de CRUD via REST. Para adicionar em sua aplicação Django no OpenShift, basta executar os comandos abaixo:</div><blockquote class="tr_bq">$ rhc ssh djangoapp<br />&gt;&nbsp;pip install djangorestframework</blockquote>&nbsp;Depois disso, iremos adicionar mais alguns códigos para expor nossa classe Pessoa para operações de CRUD. Abra o arquivo <i>wsgi/openshift/settings.py</i>&nbsp;e adicione o conteúdo em negrito:<br /><blockquote class="tr_bq">INSTALLED_APPS = (<br />&nbsp; &nbsp; 'django.contrib.auth',<br />&nbsp; &nbsp; 'django.contrib.contenttypes',<br />&nbsp; &nbsp; 'django.contrib.sessions',<br />&nbsp; &nbsp; 'django.contrib.sites',<br />&nbsp; &nbsp; 'django.contrib.messages',<br />&nbsp; &nbsp; 'django.contrib.staticfiles',<br />&nbsp; &nbsp; # Uncomment the next line to enable the admin:<br />&nbsp; &nbsp; 'django.contrib.admin',<br />&nbsp; &nbsp; # Uncomment the next line to enable admin documentation:<br />&nbsp; &nbsp; # 'django.contrib.admindocs',<br /><b>&nbsp; &nbsp; </b>'openshift',<br /><b>&nbsp; &nbsp;&nbsp;'rest_framework',</b>)&nbsp;</blockquote>Depois, abra ou crie o arquivo <i>wsgi/openshift/serializers.py</i>&nbsp;e adicione o seguinte conteúdo:<br /><br /><blockquote class="tr_bq">from openshift import models<br />from rest_framework import serializers<br />class PessoaSerializer(serializers.HyperlinkedModelSerializer):<br />&nbsp; &nbsp; &nbsp; &nbsp; class Meta:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; model = models.Pessoa<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fields = ('nome', 'idade')</blockquote><div>Esse código simplesmente define que a classe Pessoa será exposta via REST e quais são os campos que podem ser visualizados via REST. Abra o arquivo <i>wsgi/openshift/views.py</i>&nbsp;e adicione o seguinte conteúdo em negrito:</div><div><br /></div><div><blockquote class="tr_bq">import os<br />from django.shortcuts import render_to_response<br /><b>from openshift import models</b><b>from rest_framework import viewsets</b><b>from openshift import serializers</b><br />def home(request):<br />&nbsp; &nbsp; return render_to_response('home/home.html')<br /><b>class PessoaViewSet(viewsets.ModelViewSet):</b><b>&nbsp; &nbsp; &nbsp; &nbsp; queryset = models.Pessoa.objects.all()</b><b>&nbsp; &nbsp; &nbsp; &nbsp; serializer_class = serializers.PessoaSerializer</b></blockquote></div><div>Por fim, abra o arquivo <i>wsgi/openshift/urls.py</i>&nbsp;e adicione o conteúdo em negrito:</div><div><blockquote class="tr_bq">from django.conf.urls.defaults import patterns, include, url<br /><b>from rest_framework import routers</b><b>from openshift import views</b><br /><b>router = routers.DefaultRouter()</b><b>router.register(r'pessoa', views.PessoaViewSet)</b><br /># Uncomment the next two lines to enable the admin:<br />from django.contrib import admin<br />admin.autodiscover()<br />urlpatterns = patterns('',<br />&nbsp; &nbsp; # Examples:<br />&nbsp; &nbsp; <b>url(r'^rest/', include(router.urls)),</b>&nbsp; &nbsp; url(r'^$', 'openshift.views.home', name='home'),<br />&nbsp; &nbsp; # url(r'^openshift/', include('openshift.foo.urls')),<br />&nbsp; &nbsp; # Uncomment the admin/doc line below to enable admin documentation:<br />&nbsp; &nbsp; # url(r'^admin/doc/', include('django.contrib.admindocs.urls')),<br />&nbsp; &nbsp; # Uncomment the next line to enable the admin:<br />&nbsp; &nbsp; url(r'^admin/', include(admin.site.urls)),<br />)</blockquote></div><div><div>E depois é só enviar o código para o OpenShift:</div><blockquote class="tr_bq">$ git add . --all<br />$ git commit -m "Adicionando REST ao djangoapp"<br />$ git push</blockquote></div><div>Pronto! Agora é só acessar a página&nbsp;<a href="http://djangoapp-rmartinelli.rhcloud.com/rest/pessoa/">http://djangoapp-rmartinelli.rhcloud.com/rest/pessoa/</a>&nbsp;e o Django REST Framework listará todas as pessoas cadastradas. Caso queira fazer um teste, experimente criar um código simples que acesse essa URL REST e veja se você recebe os dados. O formato da resposta é o JSON, então é possível facilmente fazer um parse e listar em uma página HTML.</div><div><h3></h3><h3>Referências</h3><div><a href="http://www.djangobook.com/">http://www.djangobook.com</a><br /><a href="http://www.django-rest-framework.org/">http://www.django-rest-framework.org/</a><br /><br /><h3>Conclusão</h3></div></div><div>Por ora, essa parte &nbsp;é apenas para esquentar para que nos próximos posts eu possa falar de como criar aplicações Web, Mobile e Desktop para consumir essa API REST e assim poder demonstrar outras tecnologias/linguagens/plataformas que o OpenShift pode utilizar.</div>